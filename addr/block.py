#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import simplejson as json

from lib.utils import *
from lib.tx import *
from lib.block import *

blockjson = {
  "hash": "00000005df0740c2bb40d9a1dc73c2306116f8a271b99cf33c9348a5dff9aaee",
  "confirmations": 969,
  "size": 666,
  "height": 110369,
  "version": 536870912,
  "merkleroot": "e31c21f84b251cb7c379d9d4466f9839f1f0722b9d209fe58aa37ee81560d912",
  "tx": [
    "bb38482b4c6cbda60cb4e09b6305357bf760eb4f5ecb79ffec63f80c0196d7d1", 
    "a5830a905b09b3bce13c87a4023532c9792739ce4c5653e1d8e05668fee62838", 
    "d17e593a4063ee786a02e4a9a2935a5d4d052600e2996325cba90b54ec7c140f"
  ],
  "time": 1480352702,
  "mediantime": 1480352005,
  "nonce": 2300023,
  "bits": "1e0179e4",
  "difficulty": 0.002646227969299152,
  "chainwork": "0000000000000000000000000000000000000000000000000000082a7329ffad",
  "previousblockhash": "00000179e3d56728c05f7c70123ef57891f6dd4401fd33a6a7e1a1c72b6b2964",
  "nextblockhash": "0000013ce1549e59ff88174afbc9ce67638722583732df0a8de86c03d24d75a6"
}


rawblock_str = '0000002064296b2bc7a1e1a7a633fd0144ddf69178f53e12707c5fc02867d5e37901000012d96015e87ea38ae59f209d2b72f0f139986f46d4d979c3b71c254bf8211ce3be633c58e479011e771823000301000000010000000000000000000000000000000000000000000000000000000000000000ffffffff060321af010103ffffffff02e1340e4300000000232103d5bbec914a715f26ad8bedb7e2dcdeedfffa7f987bb557be21ae0195db34144eacdb340e43000000001976a9149d6495ba4f13848ffdf2b1803b67e55bd01c851288ac000000000100000001bdc14bd0cd26eaad8a01f1cf9521fb5b1679302e8094cb0b24e92fc02ed85964010000006a473044022050786c6f8cebd41aaf38193d461f1e38fe781294bd7b412c0429b6c2ade19221022030c67ce89779cd7351ba8aa1c9def0bf9edaa1415b78e1e19e3a508f42c8b58e012102bc8afc95c2f4d85d82fdd59f5f92213982c4347d58dbd809e7126d5ed9113836feffffff02e043727c100000001976a9143fac1ed699d6fddd1892488d129b775d6206af7c88ac8cea44c7a90000001976a91433963f7065ddcdf7f3e39c78c3aa02c58f0a82cc88ac20af01000100000001d7dae185396113aea49d6773364f554b4680862cffb2424ed027def4c9413df3010000006a4730440220559769e63ab712a9a4ab1a8fa5b6786223518f1e416070a72ecb075e8422788602206a02099a0c70ab2ec92d89aea614bb4e9a708450d36ede3bab40b077a72c89a70121020ff9a502715373a8076deaf423eb854761c67e45e54ce36aeb3562664c2d2749feffffff0200e87648170000001976a9143fac1ed699d6fddd1892488d129b775d6206af7c88ac64a9bb67290000001976a9145a799e9cd0abf2d7ebf5ab71b44319230cff903788ac20af0100'

print(json.dumps(blockjson, sort_keys=True, indent=4, separators=(',', ': '))) 
print()
print('rawblock_str: ', rawblock_str)
print()

x = decoderawblock(rawblock_str)
print(json.dumps(x, sort_keys=True, indent=4, separators=(',', ': ')))
print()

for b in x['txs'].keys():
    tx = x['txs'][b]
    dextx = decoderawtx(tx)
    print(json.dumps(dextx, sort_keys=True, indent=4, separators=(',', ': ')))
